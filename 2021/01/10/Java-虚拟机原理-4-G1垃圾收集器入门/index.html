<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Java 虚拟机原理 (四) G1垃圾收集器入门 | 湾区极客</title>
  <meta name="keywords" content=" JVM , 垃圾回收器 ">
  <meta name="description" content="Java 虚拟机原理 (四) G1垃圾收集器入门 | 湾区极客">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="索引(Index)类似于MySQL里的数据库（database）或者表（table）概念。不同于MySQL需要提前建表，ES其实支持在插入数据的时候自动建立默认索引。当然，ES 也支持自定义索引的属性以及结构。 新建索引在Kibana管理页面，我们可以通过REST APIs快速创建一个索引： PUT &#x2F;my-index-000001  也可以在创建时候指定索引的属性。比如：指定分片数为3，副本数为">
<meta property="og:type" content="article">
<meta property="og:title" content="ES学习2-索引管理">
<meta property="og:url" content="https://bayareageek.cn/2024/05/22/ES%E5%AD%A6%E4%B9%A02-%E7%B4%A2%E5%BC%95%E7%AE%A1%E7%90%86/index.html">
<meta property="og:site_name" content="湾区极客">
<meta property="og:description" content="索引(Index)类似于MySQL里的数据库（database）或者表（table）概念。不同于MySQL需要提前建表，ES其实支持在插入数据的时候自动建立默认索引。当然，ES 也支持自定义索引的属性以及结构。 新建索引在Kibana管理页面，我们可以通过REST APIs快速创建一个索引： PUT &#x2F;my-index-000001  也可以在创建时候指定索引的属性。比如：指定分片数为3，副本数为">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-05-22T00:28:20.000Z">
<meta property="article:modified_time" content="2024-06-04T00:14:54.354Z">
<meta property="article:author" content="湾区极客">
<meta property="article:tag" content="ES">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/avatar.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.1.1"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/avatar.jpg"/>
</a>
<div class="author">
    <span>湾区极客</span>
</div>

<div class="icon">
    
        
            <a title="rss"
               href="/atom.xml"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-rss"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="github"
               href="https://github.com/duval1024"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            <a title="zhihu"
               href="https://www.zhihu.com/people/duvalyang"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-zhihu"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
        
    
        
            <a title="email"
               href="mailto:869296790@qq.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=869296790&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
        
    
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="全部文章">全部文章
            
                <small>(35)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="数据库">
            
            数据库
            <small>(5)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Java">
            
            Java
            <small>(17)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Spring">
            
            Spring
            <small>(6)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="读书笔记">
            
            读书笔记
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="总结">
            
            总结
            <small>(3)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="ES">
            
            ES
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">关于</a>
        
        <a style="width: 50%"
                
                                           class="friends">友链</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="35">
<input type="hidden" id="yelog_site_word_count" value="92k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
            <li><a target="_blank" href="https://bayareageek.cn/">湾区极客</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">全部文章</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>代码整洁之道</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>读书笔记</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>垃圾回收器</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>垃圾收集器</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>类加载机制</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>生产问题</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>输入输出流</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>数据库</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>搜索</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>文件描述符</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>线程池</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>性能分析</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>源码分析</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>CAS原理</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ES</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>IO</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Java</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>JVM</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>MySQL</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Netty</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>NIO</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Reactor</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Spring</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="全部文章 ES "
           href="/2024/05/22/ES%E5%AD%A6%E4%B9%A02-%E7%B4%A2%E5%BC%95%E7%AE%A1%E7%90%86/"
           data-tag="ES"
           data-author="" >
            <span class="post-title" title="ES学习2-索引管理">ES学习2-索引管理</span>
            <span class="post-date" title="2024-05-22 08:28:20">2024/05/22</span>
        </a>
        
        
        <a  class="全部文章 ES "
           href="/2024/05/12/ES%E5%AD%A6%E4%B9%A01-%E8%AE%A4%E8%AF%86/"
           data-tag="搜索,ES"
           data-author="" >
            <span class="post-title" title="ES学习1-认识">ES学习1-认识</span>
            <span class="post-date" title="2024-05-12 15:54:55">2024/05/12</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2021/04/08/Java-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8E%9F%E7%90%86-6-ZGC-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/"
           data-tag="JVM,垃圾回收器"
           data-author="" >
            <span class="post-title" title="Java 虚拟机原理 (六) ZGC 垃圾收集器">Java 虚拟机原理 (六) ZGC 垃圾收集器</span>
            <span class="post-date" title="2021-04-08 14:39:45">2021/04/08</span>
        </a>
        
        
        <a  class="全部文章 总结 "
           href="/2021/02/09/%E7%94%9F%E4%BA%A7%E9%97%AE%E9%A2%98-3-%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E6%B5%B7%E6%81%A9%E6%B3%95%E5%88%99/"
           data-tag="生产问题"
           data-author="" >
            <span class="post-title" title="生产问题(3) 应用开发过程中的海恩法则">生产问题(3) 应用开发过程中的海恩法则</span>
            <span class="post-date" title="2021-02-09 22:18:16">2021/02/09</span>
        </a>
        
        
        <a  class="全部文章 "
           href="/2021/02/07/%E6%B7%B1%E5%85%A5-MySQL-6-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="深入 MySQL (六) 常见问题汇总">深入 MySQL (六) 常见问题汇总</span>
            <span class="post-date" title="2021-02-07 14:21:01">2021/02/07</span>
        </a>
        
        
        <a  class="全部文章 数据库 "
           href="/2021/02/06/%E6%B7%B1%E5%85%A5-MySQL-5-%E9%94%81/"
           data-tag="MySQL,数据库"
           data-author="" >
            <span class="post-title" title="深入 MySQL (五) 锁">深入 MySQL (五) 锁</span>
            <span class="post-date" title="2021-02-06 22:19:08">2021/02/06</span>
        </a>
        
        
        <a  class="全部文章 数据库 "
           href="/2021/02/05/%E6%B7%B1%E5%85%A5-MySQL-4-%E7%B4%A2%E5%BC%95/"
           data-tag="MySQL,数据库"
           data-author="" >
            <span class="post-title" title="深入 MySQL (四) 索引">深入 MySQL (四) 索引</span>
            <span class="post-date" title="2021-02-05 22:17:16">2021/02/05</span>
        </a>
        
        
        <a  class="全部文章 数据库 "
           href="/2021/02/04/%E6%B7%B1%E5%85%A5-MySQL-3-%E4%BA%8B%E5%8A%A1/"
           data-tag="MySQL,数据库"
           data-author="" >
            <span class="post-title" title="深入 MySQL (三) 事务">深入 MySQL (三) 事务</span>
            <span class="post-date" title="2021-02-04 22:20:54">2021/02/04</span>
        </a>
        
        
        <a  class="全部文章 数据库 "
           href="/2021/01/30/%E6%B7%B1%E5%85%A5-MySQL-2-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"
           data-tag="MySQL,数据库"
           data-author="" >
            <span class="post-title" title="深入 MySQL (二) 文件系统">深入 MySQL (二) 文件系统</span>
            <span class="post-date" title="2021-01-30 12:00:39">2021/01/30</span>
        </a>
        
        
        <a  class="全部文章 数据库 "
           href="/2021/01/29/%E6%B7%B1%E5%85%A5-MySQL-1-%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/"
           data-tag="MySQL,数据库"
           data-author="" >
            <span class="post-title" title="深入 MySQL (一) 体系结构">深入 MySQL (一) 体系结构</span>
            <span class="post-date" title="2021-01-29 22:50:38">2021/01/29</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2021/01/11/Java-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8E%9F%E7%90%86-5-G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E6%B7%B1%E5%85%A5/"
           data-tag="JVM,垃圾回收器"
           data-author="" >
            <span class="post-title" title="Java 虚拟机原理 (五) G1垃圾收集器深入">Java 虚拟机原理 (五) G1垃圾收集器深入</span>
            <span class="post-date" title="2021-01-11 01:00:07">2021/01/11</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2021/01/10/Java-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8E%9F%E7%90%86-4-G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8/"
           data-tag="JVM,垃圾回收器"
           data-author="" >
            <span class="post-title" title="Java 虚拟机原理 (四) G1垃圾收集器入门">Java 虚拟机原理 (四) G1垃圾收集器入门</span>
            <span class="post-date" title="2021-01-10 21:40:07">2021/01/10</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2021/01/09/Java-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8E%9F%E7%90%86-3-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/"
           data-tag="JVM,Java,垃圾收集器"
           data-author="" >
            <span class="post-title" title="Java 虚拟机原理 (三) 垃圾收集">Java 虚拟机原理 (三) 垃圾收集</span>
            <span class="post-date" title="2021-01-09 22:50:07">2021/01/09</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2021/01/08/Java-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8E%9F%E7%90%86-2-%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E5%92%8C%E5%9B%9E%E6%94%B6/"
           data-tag="JVM,Java"
           data-author="" >
            <span class="post-title" title="Java 虚拟机原理 (二) 对象创建与回收">Java 虚拟机原理 (二) 对象创建与回收</span>
            <span class="post-date" title="2021-01-08 23:56:07">2021/01/08</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2021/01/07/Java-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8E%9F%E7%90%86-1-%E5%86%85%E5%AD%98%E5%88%92%E5%88%86/"
           data-tag="JVM,Java"
           data-author="" >
            <span class="post-title" title="Java 虚拟机原理 (一) 内存划分">Java 虚拟机原理 (一) 内存划分</span>
            <span class="post-date" title="2021-01-07 22:56:07">2021/01/07</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2020/12/28/%E4%B8%80%E6%96%87%E5%BD%BB%E5%BA%95%E6%8E%8C%E6%8F%A1-Java-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/"
           data-tag="Java,类加载机制"
           data-author="" >
            <span class="post-title" title="一文彻底掌握 Java 类加载机制">一文彻底掌握 Java 类加载机制</span>
            <span class="post-date" title="2020-12-28 22:11:49">2020/12/28</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2020/12/23/%E4%B8%80%E6%96%87%E5%BD%BB%E5%BA%95%E6%8E%8C%E6%8F%A1Java-IO%E7%B1%BB%E5%BA%93/"
           data-tag="Java,IO"
           data-author="" >
            <span class="post-title" title="一文彻底掌握Java IO类库">一文彻底掌握Java IO类库</span>
            <span class="post-date" title="2020-12-23 22:57:44">2020/12/23</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2020/12/16/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E6%96%87%E4%BB%B6%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%B5%81%E5%92%8C%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6/"
           data-tag="Java,文件描述符,输入输出流"
           data-author="" >
            <span class="post-title" title="深入理解Java文件输入输出流和文件描述符">深入理解Java文件输入输出流和文件描述符</span>
            <span class="post-date" title="2020-12-16 22:03:33">2020/12/16</span>
        </a>
        
        
        <a  class="全部文章 总结 "
           href="/2020/12/15/%E7%94%9F%E4%BA%A7%E9%97%AE%E9%A2%98-2-ExceptionInInitializerError%E5%AF%BC%E8%87%B4%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%AD%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%BC%82%E5%B8%B8%E8%A2%AB%E5%90%9E/"
           data-tag="生产问题"
           data-author="" >
            <span class="post-title" title="生产问题(2) ExceptionInInitializerError导致线程池中的线程异常被吞">生产问题(2) ExceptionInInitializerError导致线程池中的线程异常被吞</span>
            <span class="post-date" title="2020-12-15 17:26:29">2020/12/15</span>
        </a>
        
        
        <a  class="全部文章 读书笔记 "
           href="/2020/11/14/%E4%BB%A3%E7%A0%81%E6%95%B4%E6%B4%81%E4%B9%8B%E9%81%93/"
           data-tag="读书笔记,代码整洁之道"
           data-author="" >
            <span class="post-title" title="《代码整洁之道》">《代码整洁之道》</span>
            <span class="post-date" title="2020-11-14 17:01:02">2020/11/14</span>
        </a>
        
        
        <a  class="全部文章 Spring "
           href="/2020/10/26/%E5%86%8D%E8%AF%BBSpring%E6%BA%90%E7%A0%81%E4%B9%8B%E4%B8%89-%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95%E7%82%B9/"
           data-tag="源码分析,Spring"
           data-author="" >
            <span class="post-title" title="再读Spring源码之三 常用扩展点">再读Spring源码之三 常用扩展点</span>
            <span class="post-date" title="2020-10-26 18:31:25">2020/10/26</span>
        </a>
        
        
        <a  class="全部文章 Spring "
           href="/2020/10/07/%E5%86%8D%E8%AF%BBSpring%E6%BA%90%E7%A0%81%E4%B9%8B%E4%BA%8C-FactoryBean/"
           data-tag="源码分析,Spring"
           data-author="" >
            <span class="post-title" title="再读Spring源码之二 FactoryBean">再读Spring源码之二 FactoryBean</span>
            <span class="post-date" title="2020-10-07 21:00:39">2020/10/07</span>
        </a>
        
        
        <a  class="全部文章 Spring "
           href="/2020/08/21/%E5%86%8D%E8%AF%BBSpring%E6%BA%90%E7%A0%81%E4%B9%8B%E4%B8%80-Spring%E5%A6%82%E4%BD%95%E5%AF%B9%E4%BB%98%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8/"
           data-tag="源码分析,Spring"
           data-author="" >
            <span class="post-title" title="再读Spring源码之一 Spring如何对付循环引用">再读Spring源码之一 Spring如何对付循环引用</span>
            <span class="post-date" title="2020-08-21 20:59:52">2020/08/21</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2020/07/15/Netty-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B-%E5%85%AD-%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%A4%84%E7%90%86%E5%99%A8-Handler/"
           data-tag="Netty,源码分析"
           data-author="" >
            <span class="post-title" title="Netty 源码分析之 六 流水线处理器: Handler">Netty 源码分析之 六 流水线处理器: Handler</span>
            <span class="post-date" title="2020-07-15 22:15:35">2020/07/15</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2020/07/09/Netty-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B-%E4%BA%94-%E5%A5%94%E8%85%BE%E7%9A%84%E8%A1%80%E6%B6%B2-ByteBuf/"
           data-tag="Netty,源码分析"
           data-author="" >
            <span class="post-title" title="Netty 源码分析之 五 奔腾的血液: ByteBuf">Netty 源码分析之 五 奔腾的血液: ByteBuf</span>
            <span class="post-date" title="2020-07-09 23:30:20">2020/07/09</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2020/07/04/Netty-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E4%B9%8B-%E5%9B%9B-Promise-%E4%B8%8E-Future-%E5%8F%8C%E5%AD%90%E6%98%9F%E7%9A%84%E7%A7%98%E5%AF%86/"
           data-tag="Netty,源码分析"
           data-author="" >
            <span class="post-title" title="Netty 源码分析之 四 Promise 与 Future: 双子星的秘密">Netty 源码分析之 四 Promise 与 Future: 双子星的秘密</span>
            <span class="post-date" title="2020-07-04 16:10:56">2020/07/04</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2020/06/12/Java%E9%AB%98%E6%80%A7%E8%83%BD%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B-Reactor%E6%A8%A1%E5%9E%8B/"
           data-tag="NIO,Reactor"
           data-author="" >
            <span class="post-title" title="Java高性能网络编程--Reactor模型">Java高性能网络编程--Reactor模型</span>
            <span class="post-date" title="2020-06-12 14:48:28">2020/06/12</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2020/05/14/%E8%AE%A4%E8%AF%86Java-NIO/"
           data-tag="NIO"
           data-author="" >
            <span class="post-title" title="认识 Java NIO">认识 Java NIO</span>
            <span class="post-date" title="2020-05-14 15:27:54">2020/05/14</span>
        </a>
        
        
        <a  class="全部文章 总结 "
           href="/2020/02/11/%E7%94%9F%E4%BA%A7%E9%97%AE%E9%A2%98-1-Java%E8%BF%9B%E7%A8%8BCPU%E5%8D%A0%E7%94%A8%E8%BF%87%E9%AB%98/"
           data-tag="生产问题"
           data-author="" >
            <span class="post-title" title="生产问题(1) Java进程CPU占用过高">生产问题(1) Java进程CPU占用过高</span>
            <span class="post-date" title="2020-02-11 21:49:14">2020/02/11</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2020/01/05/%E6%B7%B1%E5%85%A5JAVA%E8%AF%AD%E8%A8%80%E2%80%94CAS%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90/"
           data-tag="CAS原理"
           data-author="" >
            <span class="post-title" title="深入JAVA语言—CAS原理剖析">深入JAVA语言—CAS原理剖析</span>
            <span class="post-date" title="2020-01-05 18:16:26">2020/01/05</span>
        </a>
        
        
        <a  class="全部文章 Spring "
           href="/2018/10/12/Spring%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%903-%E5%AF%B9Bean%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E7%9A%84%E5%A4%84%E7%90%86/"
           data-tag="源码分析,Spring"
           data-author="" >
            <span class="post-title" title="Spring源码分析3-对Bean循环依赖的处理">Spring源码分析3-对Bean循环依赖的处理</span>
            <span class="post-date" title="2018-10-12 15:47:01">2018/10/12</span>
        </a>
        
        
        <a  class="全部文章 Spring "
           href="/2018/07/12/Spring%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%901-RESTful%20Web%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/"
           data-tag="源码分析,Spring"
           data-author="" >
            <span class="post-title" title="Spring源码分析1-RESTfulWeb启动过程">Spring源码分析1-RESTfulWeb启动过程</span>
            <span class="post-date" title="2018-07-12 11:47:01">2018/07/12</span>
        </a>
        
        
        <a  class="全部文章 Spring "
           href="/2018/07/12/Spring%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%902-%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%B7%E6%96%B0%E8%BF%87%E7%A8%8B/"
           data-tag="源码分析,Spring"
           data-author="" >
            <span class="post-title" title="Spring源码分析2-上下文刷新过程分析">Spring源码分析2-上下文刷新过程分析</span>
            <span class="post-date" title="2018-07-12 11:47:01">2018/07/12</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2017/08/10/Java-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%A6%E8%A7%A3/"
           data-tag="线程池"
           data-author="" >
            <span class="post-title" title="Java 线程池详解">Java 线程池详解</span>
            <span class="post-date" title="2017-08-10 16:47:18">2017/08/10</span>
        </a>
        
        
        <a  class="全部文章 Java "
           href="/2017/06/18/JVM%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7%E6%80%BB%E7%BB%93/"
           data-tag="JVM,性能分析"
           data-author="" >
            <span class="post-title" title="JVM性能监控工具总结">JVM性能监控工具总结</span>
            <span class="post-date" title="2017-06-18 16:47:54">2017/06/18</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-Java-虚拟机原理-4-G1垃圾收集器入门" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Java 虚拟机原理 (四) G1垃圾收集器入门</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="Java">Java</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color4">JVM</a>
            
            <a class="color1">垃圾回收器</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2024-02-18 21:17:51'>2021-01-10 21:40</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:8.1k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="跳转至评论区">
            <a href="#comments">
                评论:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%A7%88"><span class="toc-text">概览</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E7%9B%AE%E7%9A%84"><span class="toc-text">本文目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E4%BC%B0%E9%98%85%E8%AF%BB%E6%97%B6%E9%97%B4"><span class="toc-text">预估阅读时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E7%AE%80%E4%BB%8B"><span class="toc-text">本文简介</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AF%E7%A1%AC%E4%BB%B6%E9%85%8D%E7%BD%AE%E8%A6%81%E6%B1%82"><span class="toc-text">软硬件配置要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E6%8F%90"><span class="toc-text">前提</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E4%BB%A5%E5%8F%8AJVM%E6%8A%80%E6%9C%AF"><span class="toc-text">Java以及JVM技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Java%E6%A6%82%E8%A7%88"><span class="toc-text">Java概览</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Java%E8%BF%90%E8%A1%8C%E6%97%B6%E7%89%88%E6%9C%AC"><span class="toc-text">Java运行时版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Java%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80"><span class="toc-text">Java编程语言</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Java%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E5%8C%85"><span class="toc-text">Java开发工具包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Java%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-text">Java虚拟机</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A2%E7%A9%B6JVM%E6%9E%B6%E6%9E%84"><span class="toc-text">探究JVM架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Hotspot%E6%9E%B6%E6%9E%84"><span class="toc-text">Hotspot架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HotSpot%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-text">HotSpot核心组件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="toc-text">性能指标</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4"><span class="toc-text">响应时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%9E%E5%90%90%E9%87%8F"><span class="toc-text">吞吐量</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-text">G1垃圾收集器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#G1-%E5%9B%9E%E6%94%B6%E8%BF%87%E7%A8%8B%E6%A6%82%E8%A7%88"><span class="toc-text">G1 回收过程概览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#G1%E5%8D%A0%E7%94%A8%E7%A9%BA%E9%97%B4"><span class="toc-text">G1占用空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#G1%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B%E5%BB%BA%E8%AE%AE"><span class="toc-text">G1使用案例建议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E9%A1%BECMS%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8"><span class="toc-text">回顾CMS垃圾收集器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84"><span class="toc-text">堆内存结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8CYoung-GC"><span class="toc-text">如何进行Young GC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B4%E8%BD%BB%E4%BB%A3%E6%94%B6%E9%9B%86%E8%BF%87%E7%A8%8B"><span class="toc-text">年轻代收集过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B4%E8%BD%BB%E4%BB%A3%E6%94%B6%E9%9B%86%E4%B9%8B%E5%90%8E"><span class="toc-text">年轻代收集之后</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CMS%E7%9A%84%E8%80%81%E5%B9%B4%E4%BB%A3%E6%94%B6%E9%9B%86%E8%BF%87%E7%A8%8B"><span class="toc-text">CMS的老年代收集过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%81%E5%B9%B4%E4%BB%A3%E6%94%B6%E9%9B%86%E8%BF%87%E7%A8%8B-%E2%80%94-%E5%B9%B6%E5%8F%91%E6%B8%85%E9%99%A4"><span class="toc-text">老年代收集过程 — 并发清除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%81%E5%B9%B4%E4%BB%A3%E6%94%B6%E9%9B%86%E8%BF%87%E7%A8%8B-%E2%80%94-%E5%B9%B6%E5%8F%91%E6%B8%85%E9%99%A4%E4%B9%8B%E5%90%8E"><span class="toc-text">老年代收集过程 — 并发清除之后</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E6%AD%A5%E9%AA%A4%E5%88%86%E6%9E%90"><span class="toc-text">G1垃圾收集器步骤分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E6%AD%A5%E9%AA%A4%E5%88%86%E6%9E%90-1"><span class="toc-text">G1垃圾收集器步骤分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-G1%E5%A0%86%E7%A9%BA%E9%97%B4%EF%BC%88G1-Heap-Structure%EF%BC%89"><span class="toc-text">1.G1堆空间（G1 Heap Structure）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-G1%E5%A0%86%E7%A9%BA%E9%97%B4%E5%88%86%E9%85%8D%EF%BC%88G1-Heap-Allocation%EF%BC%89"><span class="toc-text">2.G1堆空间分配（G1 Heap Allocation）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-G1%E7%9A%84%E5%B9%B4%E8%BD%BB%E4%BB%A3%EF%BC%88Young-Generation-in-G1%EF%BC%89"><span class="toc-text">3.G1的年轻代（Young Generation in G1）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-G1%E7%9A%84%E4%B8%80%E6%AC%A1-Young-GC%EF%BC%88A-Young-GC-in-G1%EF%BC%89"><span class="toc-text">4.G1的一次 Young GC（A Young GC in G1）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-G1%E7%9A%84Young-GC%E7%BB%93%E6%9D%9F%E4%B9%8B%E5%90%8E%EF%BC%88End-of-a-Young-GC-with-G1%EF%BC%89"><span class="toc-text">5.G1的Young GC结束之后（End of a Young GC with G1）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%9A%84%E9%98%B6%E6%AE%B5-%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0%E5%91%A8%E6%9C%9F%E9%98%B6%E6%AE%B5"><span class="toc-text">G1垃圾收集的阶段 - 并发标记周期阶段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%90%E6%AD%A5%E5%88%86%E6%9E%90G1%E7%9A%84%E8%80%81%E5%B9%B4%E4%BB%A3%E6%94%B6%E9%9B%86%E8%BF%87%E7%A8%8B"><span class="toc-text">逐步分析G1的老年代收集过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%88%9D%E5%A7%8B%E6%A0%87%E8%AE%B0%E9%98%B6%E6%AE%B5%EF%BC%88Initial-Marking-Phase%EF%BC%89"><span class="toc-text">6.初始标记阶段（Initial Marking Phase）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0%E9%98%B6%E6%AE%B5%EF%BC%88Concurrent-Marking-Phase%EF%BC%89"><span class="toc-text">7.并发标记阶段（Concurrent Marking Phase）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E9%87%8D%E6%96%B0%E6%A0%87%E8%AE%B0%E9%98%B6%E6%AE%B5%EF%BC%88Remark-Phase%EF%BC%89"><span class="toc-text">8.重新标记阶段（Remark Phase）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E5%A4%8D%E5%88%B6%E6%B8%85%E7%90%86%E9%98%B6%E6%AE%B5%EF%BC%88Copying-Cleanup-Phase%EF%BC%89"><span class="toc-text">9.复制清理阶段（Copying&#x2F;Cleanup Phase）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-%E5%A4%8D%E5%88%B6%E6%B8%85%E7%90%86%E9%98%B6%E6%AE%B5%E4%B9%8B%E5%90%8E%EF%BC%88After-Copying-Cleanup-Phase%EF%BC%89"><span class="toc-text">10.复制清理阶段之后（After Copying&#x2F;Cleanup Phase）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%80%81%E5%B9%B4%E4%BB%A3%E5%9B%9E%E6%94%B6%E8%BF%87%E7%A8%8B%E6%80%BB%E7%BB%93"><span class="toc-text">老年代回收过程总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E5%8F%AF%E9%80%89%E9%A1%B9%E4%BB%A5%E5%8F%8A%E6%9C%80%E4%BD%B3%E6%97%B6%E9%97%B4"><span class="toc-text">命令行参数可选项以及最佳时间</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%9F%BA%E6%9C%AC%E5%8F%82%E6%95%B0"><span class="toc-text">命令行基本参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%85%B3%E9%94%AE%E5%8F%82%E6%95%B0"><span class="toc-text">命令行关键参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-text">最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E8%A6%81%E8%AE%BE%E7%BD%AE%E5%B9%B4%E8%BD%BB%E4%BB%A3%E7%9A%84%E5%A4%A7%E5%B0%8F"><span class="toc-text">不要设置年轻代的大小</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%97%B6%E9%97%B4%E6%8C%87%E6%A0%87"><span class="toc-text">响应时间指标</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%96%8F%E6%95%A3%E5%A4%B1%E8%B4%A5-Evacuation-Failure"><span class="toc-text">什么是疏散失败?(Evacuation Failure)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E7%96%8F%E6%95%A3%E5%A4%B1%E8%B4%A5"><span class="toc-text">如何避免疏散失败</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#G1%E5%AE%8C%E6%95%B4%E7%9A%84GC%E5%BC%80%E5%85%B3"><span class="toc-text">G1完整的GC开关</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#G1%E7%9A%84GC%E6%97%A5%E5%BF%97"><span class="toc-text">G1的GC日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%97%A5%E5%BF%97%E8%AF%A6%E6%83%85"><span class="toc-text">设置日志详情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E6%97%B6%E9%97%B4%E5%8F%82%E6%95%B0"><span class="toc-text">指定时间参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86G1%E6%97%A5%E5%BF%97"><span class="toc-text">认识G1日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#G1%E6%97%A5%E5%BF%97%E6%9C%AF%E8%AF%AD"><span class="toc-text">G1日志术语</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%84%E6%BA%90"><span class="toc-text">资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%B8%A3%E8%B0%A2"><span class="toc-text">鸣谢</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文翻译自<a target="_blank" rel="noopener" href="https://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/index.html">《Getting Started with the G1 Garbage Collector》</a></p>
<span id="more"></span>

<h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><h3 id="本文目的"><a href="#本文目的" class="headerlink" title="本文目的"></a>本文目的</h3><p>本教程介绍了如何使用G1垃圾收集器以及如何在Hostspot虚拟机中使用它。你可以学习到G1垃圾收集器的内部运行机制、切换到使用G1垃圾回收器的命令行关键参数以及打印GC日志的选项参数。</p>
<h3 id="预估阅读时间"><a href="#预估阅读时间" class="headerlink" title="预估阅读时间"></a>预估阅读时间</h3><p>大概1小时</p>
<h3 id="本文简介"><a href="#本文简介" class="headerlink" title="本文简介"></a>本文简介</h3><p>本教程详细介绍了Java语言的G1垃圾收集器。主要内容分为五部分：</p>
<ul>
<li>通过介绍垃圾收集器以及性能来了解JVM虚拟机；</li>
<li>逐步分析G1垃圾收集器的每一个过程；</li>
<li>回顾CMS收集器的每一个过程；</li>
<li>介绍G1垃圾收集器可用的一些选项参数；</li>
<li>介绍G1垃圾收集器的日志参数。</li>
</ul>
<h2 id="软硬件配置要求"><a href="#软硬件配置要求" class="headerlink" title="软硬件配置要求"></a>软硬件配置要求</h2><p>以下是软硬件要求列表：</p>
<ul>
<li>PC(Window XP或更新、Mac OS X、Linux)</li>
<li>Java 7u9 或更新版本</li>
<li>最新的Java 7样例以及压缩包</li>
</ul>
<h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><p>在开始本教程之前，你需要：</p>
<ul>
<li>下载安装最新的JDK（JDK 7u9或更新版本）<a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK 7下载地址</a></li>
<li>下载解压样例压缩包到相应目录，例如：C:\javademos</li>
</ul>
<h2 id="Java以及JVM技术"><a href="#Java以及JVM技术" class="headerlink" title="Java以及JVM技术"></a>Java以及JVM技术</h2><h3 id="Java概览"><a href="#Java概览" class="headerlink" title="Java概览"></a>Java概览</h3><p>Java是Sun Microsystems公司在1995年第一次发布的一门编程语言。它是构建包括游戏、商业、基础设施等Java应用程序的底层技术。在全世界范围内，Java运行在超过8.5亿个人电脑以及数十亿的手机电视设备上。总体上看，Java平台由以下几个关键的组件构成。</p>
<h4 id="Java运行时版本"><a href="#Java运行时版本" class="headerlink" title="Java运行时版本"></a>Java运行时版本</h4><p>当你下载Java的时候，你可以获取Java运行时环境（JRE）。JRE是由Java虚拟机（JVM）、Java平台核心类和支撑Java平台的库构成。这三者都是Java应用运行所必需的组件。通过Java7，Java应用在个人电脑上的运行形式可以是操作系统桌面应用，也可以是通过Java Web Start从Web上安装的桌面应用，或者是内嵌在浏览器中的Web应用（使用JavaFX)</p>
<h4 id="Java编程语言"><a href="#Java编程语言" class="headerlink" title="Java编程语言"></a>Java编程语言</h4><p>Java是一门面向对象编程语言，包含以下特性：</p>
<ul>
<li>平台独立性 - Java应用会被编译成保存在class文件中的字节码，并且被加载进虚拟机中。因为Java应用总是运行在虚拟机中，所以Java应用可以运行在各种不同的操作系统和设备上；</li>
<li>面向对象 - Java是一门面向对象的编程语言，具有很多与C、C++类似特性，并对其进行了改进；</li>
<li>全自动垃圾收集 - Java会自动分配和回收内存，程序中无需关心这个过程；</li>
<li>丰富的库资源 - Java有大量预置的类库可以进行诸如IO、网络传输、日期操作等任务。</li>
</ul>
<h4 id="Java开发工具包"><a href="#Java开发工具包" class="headerlink" title="Java开发工具包"></a>Java开发工具包</h4><p>Java开发工具包 The Java Development Kit (JDK) 是用来开发Java应用的一系列工具。通过JDK，你可以编译Java应用，并且运行在JVM中。此外JDK提供了打包和分发你的应用的工具。</p>
<p>JDK和JRE共用了Java应用编程接口（Java API）。Java API是用来创建Java应用的一系列预编译库。它使得开发一些常用的程序更加便捷，比如：字符串操作、日期时间处理、网络传输、实现数据结构（例如 lists, maps, stacks, and queues)。</p>
<h4 id="Java虚拟机"><a href="#Java虚拟机" class="headerlink" title="Java虚拟机"></a>Java虚拟机</h4><p>Java虚拟机（JVM）是一个抽象的计算机器。JVM本质上是一个程序，它就像一台机器一样写入程序并且执行。因此，所有的Java程序都按照同一套接口和库写入到JVM中。每一个针对特定操作系统的JVM实现都将Java程序指令翻译为本地操作系统中的指令。这样，Java就实现了平台独立性。</p>
<p>Java虚拟机的第一个原型是由Sun Microsystems完成的，它在一个类似现在的个人数字代理（PDA）的手持设备上模拟了Java虚拟机指令集。现在Oracle已经实现在移动、桌面和服务器设备上模拟 Java 虚拟机，但Java虚拟机不承担任何特定的实现技术、主机硬件或操作系统。</p>
<p>（非关键内容，此处略）</p>
<h3 id="探究JVM架构"><a href="#探究JVM架构" class="headerlink" title="探究JVM架构"></a>探究JVM架构</h3><h4 id="Hotspot架构"><a href="#Hotspot架构" class="headerlink" title="Hotspot架构"></a>Hotspot架构</h4><p>HotSpot JVM 拥有一个支持强大特性和功能基础的架构，并支持实现高性能和大规模扩展性。例如HostSpot JVM JIT编译器生成动态优化。换句话说，是在运行 Java 应用程序时做出优化决策，并生成针对底层系统体系结构的高性能本地指令。此外，经过对它的运行时环境和多线程垃圾收集器的不断的成熟进化和持续的研发，HostSpot JVM在现今所有操作系统中都有很高的可拓展性。</p>
<p><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog/G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8/HotspotJVM%E6%9E%B6%E6%9E%84.png" alt="HotSpot JVM架构图"></p>
<p>JVM主要的组件包括类加载器、运行时数据区域以及执行引擎。（the class loader, the runtime data areas, and the execution engine）</p>
<h4 id="HotSpot核心组件"><a href="#HotSpot核心组件" class="headerlink" title="HotSpot核心组件"></a>HotSpot核心组件</h4><p>JVM中与性能表现有关的核心组件已在下图高亮显示。<br><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog/G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8/JVM%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6.png" alt="JVM核心组件"></p>
<p>在调优JVM性能的时候，主要关注这三个组件。堆(heap)是你的对象数据存储的区域。该区域由程序启动指定的垃圾收集器管理。大多数调优选项都跟调整堆大小和选择最合适的垃圾回收器相关。JIT编译器对性能也有很大影响，但是在较新版本的JVM里很少需要调优。</p>
<h3 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h3><p>通常在调优Java应用的时候，会关注两个主要的指标：响应时间和吞吐量。</p>
<h4 id="响应时间"><a href="#响应时间" class="headerlink" title="响应时间"></a>响应时间</h4><p>响应时间就是应用或者系统应答所请求的数据的用时。例如：</p>
<ul>
<li>桌面UI响应时间用时；</li>
<li>网站返回一个页面用时；</li>
<li>数据库查询返回用时。</li>
</ul>
<p>对所有的对响应时间敏感的应用来说，很长的暂停时间是不能接受的。此时应当关注实现更短的应答时间。</p>
<h4 id="吞吐量"><a href="#吞吐量" class="headerlink" title="吞吐量"></a>吞吐量</h4><p>吞吐量指标关注的是该应用在一段时间内能处理的最大工作量。例如：</p>
<ul>
<li>一段时间内完成的事务数量；</li>
<li>一个批处理程序一个小时内完成的任务数量；</li>
<li>数据库在一个小时内完成的查询数量。</li>
</ul>
<p>长暂停对这些关注吞吐量的应用来说是可以接受的。因为高吞吐量应用关注的一段时间内的基准测试，而快速响应并不是一个考量点。</p>
<h2 id="G1垃圾收集器"><a href="#G1垃圾收集器" class="headerlink" title="G1垃圾收集器"></a>G1垃圾收集器</h2><p>G1垃圾收集器（Garbage-First collector）是一个面向多核心大内存机器的服务端收集器。<br>它能以大概率满足垃圾收集暂停时间目标，同时实现高吞吐量。Oracle JDK 7u4以及更新版本完全支持G1垃圾收集器。G1收集器专门为以下应用而设计：</p>
<ul>
<li>能够像CMS垃圾收集器一样和应用线程并发执行；</li>
<li>无需较长的GC停顿时间来实现内存压缩；</li>
<li>需要更可预测的GC暂停时间；</li>
<li>不希望牺牲大量的吞吐量性能；</li>
<li>不需要更大的Java堆空间。</li>
</ul>
<p>G1计划作为CMS的长期替代。G1和CMS相比，两者的许多不同点使得G1成为更好的解决方案。其中一个不同就是G1是一个能内存压缩的收集器。G1的内存压缩使得能够完全避免使用细粒度的空闲列表来分配内存，而是依靠regions。这大大简化了垃圾收集器，并大大消除了潜在的碎片化问题。另外，G1比CMS提供了更可预测的垃圾收集暂停时间，允许用户指定期望的暂停时间。</p>
<h3 id="G1-回收过程概览"><a href="#G1-回收过程概览" class="headerlink" title="G1 回收过程概览"></a>G1 回收过程概览</h3><p>以前的垃圾收集器（serial, parallel, CMS）都将堆划分为特定内存大小的3部分：年轻代、老年代和永久代。</p>
<p><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog/G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8/Hotspot%20Heap%20Structure.png" alt="Hotspot Heap Structure"></p>
<p>所有的内存对象最终都会位于这三部分之一。<br>但G1垃圾收集器采用了不同的方法。</p>
<p><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog/G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8/G1%20Heap%20Allocation.png" alt="G1 Heap Allocation"></p>
<p>堆内存被划分成一系列相同大小的连续虚拟内存的区块（region）。这些区块都被分配了和以前收集器相同的角色（比如 eden, survivor, old），但相同角色的区块数量不是确定的。这使得堆内存使用上有非常大的灵活性。</p>
<p>当执行垃圾收集的时候，G1的工作方式和CMS类似。G1执行并发全局标记阶段来决定堆内的存活对象。当标记阶段完成后，G1知道哪些区块（regions）是最空闲的。它会优先收集这些区块，因为回收它们通常可以获得大量空闲内存。这也是为什么这种垃圾回收方式被称为Garbage-First。顾名思义，G1在它的收集和压缩阶段关注堆里最有可能包含大量可回收对象（也就是垃圾）的区域。G1使用一个暂停预测模型来满足用户指定的暂停时间目标，并根据指定的暂停时间目标来选择回收的区块数量。</p>
<p>被G1标记为可回收的区块会通过疏散方法(evacuation)来进行垃圾回收。G1从一个或者多个区块中复制对象到堆内的一个区块，在这个过程中会同时压缩和释放内存空间。为了减少停顿时间和提高吞吐量，这个疏散过程在多核心机器上是并发执行的。因此，在每一个垃圾收集过程中，G1在用户指定的停顿时间目标内不断地减少内存碎片。这超过了以往的两种回收方法的功能。CMS（Concurrent Mark Sweep）垃圾收集器没有进行内存压缩。ParallelOld垃圾回收器只进行全堆的压缩，会导致非常长的暂停时间。</p>
<p>但值得注意的是G1不是一个实时收集器。它会以较高概率但并不绝对保证满足用户设定的停顿时间。G1根据之前回收的数据来评估在用户指定的停顿时间内能够回收多少个区块（region）。</p>
<p><strong>注意：</strong> G1既有并行阶段（与应用线程并行运行，例如：refinement, marking, cleanup等过程），也有并发阶段（多线程并发运行，例如stop the world）。Full GC依然是单线程的，但是如果调优到位的话，你的应用应该避免Full GC发生。</p>
<h3 id="G1占用空间"><a href="#G1占用空间" class="headerlink" title="G1占用空间"></a>G1占用空间</h3><p>如果你从ParallelOldGC或者CMS迁移到G1，你会发现JVM占用的进程空间更大。这主要是因为一些记录数据（”accounting” data structures），例如 RSets和CSets（Remembered Sets and Collection Sets）。</p>
<p>RSets跟踪了那些指向这个区块的对象。在堆中，每一个Region都对应着一个RSet。RSets使得区块能够并行且独立地进行回收。全部RSets占用的空间不超过5%。</p>
<p>CSets记录了在一次GC中将会被回收的区块集合。CSets里的所有存活的数据在GC中都会被压缩（复制整理）。这些区块角色可以是Eden, survivor, 或者 old generation。全部CSets占用的空间不会超过1%。</p>
<h3 id="G1使用案例建议"><a href="#G1使用案例建议" class="headerlink" title="G1使用案例建议"></a>G1使用案例建议</h3><p>G1首要关注的是在一个大堆中以有限的GC延迟运行用户应用。这意味着堆的大小应该在6GB或者更大，而且稳定运行的期望暂停时间应该在0.5s以内。</p>
<p>现在已经运行在CMS 或者 ParallelOldGC 垃圾收集器上的应用，如果考虑切换到G1，应当考虑是否满足以下一个或者多个条件：</p>
<ul>
<li>Full GC持续时间太长太频繁；</li>
<li>对象的分配速度和对象的晋升速度差异非常大；</li>
<li>不希望长时间的GC收集以及压缩停顿时间。</li>
</ul>
<p><strong>注意：</strong> 如果你正在使用CMS 或者 ParallelOldGC，并且你的应用没有较长的GC停顿时间，那你应该继续使用当前的GC收集器。最新的JDK并不要求一定使用G1垃圾收集器。</p>
<h2 id="回顾CMS垃圾收集器"><a href="#回顾CMS垃圾收集器" class="headerlink" title="回顾CMS垃圾收集器"></a>回顾CMS垃圾收集器</h2><p>接下来，让我们回顾CMS垃圾收集器的各个阶段。</p>
<h3 id="堆内存结构"><a href="#堆内存结构" class="headerlink" title="堆内存结构"></a>堆内存结构</h3><p>堆被划分为三个空间。<br><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog/G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8/CMS%20Heap%20Structure.png"></p>
<p>年轻代被划分为Eden区和两个Suvivor区。老年代是一个连续的内存空间。除非Full GC发生，否则不会发生内存压缩。</p>
<h3 id="如何进行Young-GC"><a href="#如何进行Young-GC" class="headerlink" title="如何进行Young GC"></a>如何进行Young GC</h3><p>下图中，新生代以绿色表示，而老年代用蓝色表示。当你的应用运行了一段时间后，CMS的运行情况大概如图所示。对象分散在老年代的各个角落。</p>
<p><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog/G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8/How%20young%20GC%20Works.png" alt="How young GC works"></p>
<p>在CMS回收过程中，老年代对象会原地回收。它们不会被移动到其他地方。堆空间在Full GC发生前不会被压缩。</p>
<h3 id="年轻代收集过程"><a href="#年轻代收集过程" class="headerlink" title="年轻代收集过程"></a>年轻代收集过程</h3><p>存活对象会从Eden区和其中一个Suvivor区复制到另外一个Suvivor区域。所有的超过老化阈值（aging threshold）的较老对象都会被晋升到老年代中。</p>
<p><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog/G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8/Young%20Generration%20Collection.png" alt="Young Generration Collection"></p>
<h3 id="年轻代收集之后"><a href="#年轻代收集之后" class="headerlink" title="年轻代收集之后"></a>年轻代收集之后</h3><p>年轻代收集结束后，Eden区和其中一个Survivor区会被清空。<br><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog/G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8/After%20Young%20GC.png" alt="After Young GC"></p>
<p>刚被晋升的对象在图里以深蓝色标注。绿色标注的对象是那些在新生代收集中存活且没有被晋升到老年代的对象。</p>
<h3 id="CMS的老年代收集过程"><a href="#CMS的老年代收集过程" class="headerlink" title="CMS的老年代收集过程"></a>CMS的老年代收集过程</h3><p>这过程会有两个步骤发生stop the world，分别是：初始标记和重新标记。当老年代到达指定的占有率，CMS会被触发。</p>
<p><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog/G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8/Old%20gen%20collection%20in%20CMS.png" alt="Old gen collection in CMS"></p>
<ul>
<li>初始标记是一个很短的阶段，用来标记那些存活的（可达的）对象；</li>
<li>并发标记会在应用运行过程中寻找存活对象；</li>
<li>最后那些在并发标记中被漏掉的对象会在重新标记阶段被标记。</li>
</ul>
<h3 id="老年代收集过程-—-并发清除"><a href="#老年代收集过程-—-并发清除" class="headerlink" title="老年代收集过程 — 并发清除"></a>老年代收集过程 — 并发清除</h3><p>那些在之前的阶段中没有被标记的对象会被清除掉。但在这个过程中并没有内存压缩。<br><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog/G1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8/Old%20Gen%20Collection%20---%20concurrent%20sweep.png" alt="Old Gen Collection - concurrent sweep"></p>
<p><strong>注意：</strong> 未标记对象 &#x3D;&#x3D; 死亡对象</p>
<h3 id="老年代收集过程-—-并发清除之后"><a href="#老年代收集过程-—-并发清除之后" class="headerlink" title="老年代收集过程 — 并发清除之后"></a>老年代收集过程 — 并发清除之后</h3><p>在并发清除结束之后，大量的内存空间会被释放出来。此外，你还会注意到并没有发生内存压缩。<br><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog%2FG1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8%2FOld%20Gen%20Collection%20-%20After%20Sweep.png" alt="Old Gen Collection - After Sweep.png"></p>
<p>最后CMS垃圾收集器会进入重置阶段，然后等待下一次达到GC触发阈值。</p>
<h2 id="G1垃圾收集器步骤分析"><a href="#G1垃圾收集器步骤分析" class="headerlink" title="G1垃圾收集器步骤分析"></a>G1垃圾收集器步骤分析</h2><h3 id="G1垃圾收集器步骤分析-1"><a href="#G1垃圾收集器步骤分析-1" class="headerlink" title="G1垃圾收集器步骤分析"></a>G1垃圾收集器步骤分析</h3><p>G1垃圾收集器使用了一种不同的方式去分配堆空间。下面各图会逐步介绍G1的各个步骤。</p>
<h4 id="1-G1堆空间（G1-Heap-Structure）"><a href="#1-G1堆空间（G1-Heap-Structure）" class="headerlink" title="1.G1堆空间（G1 Heap Structure）"></a>1.G1堆空间（G1 Heap Structure）</h4><p>堆空间会被分割成许多相同大小的区块（regions）。<br><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog%2FG1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8%2FG1%20Heap%20Structure.png" alt="G1 Heap Structure.png"></p>
<p>区块大小在JVM启动之初就会决定。JVM通常会分配大小为1Mb到32Mb大小范围内的大约2000个区块。</p>
<h4 id="2-G1堆空间分配（G1-Heap-Allocation）"><a href="#2-G1堆空间分配（G1-Heap-Allocation）" class="headerlink" title="2.G1堆空间分配（G1 Heap Allocation）"></a>2.G1堆空间分配（G1 Heap Allocation）</h4><p>实际上，这些区块会被分配为Eden、Survivor和Old Generation等逻辑区域。<br><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog%2FG1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8%2FG1%20Heap%20Allocation.png" alt="G1 Heap Allocation.png"></p>
<p>上图中不同颜色的区块表示的是不同的角色。存活的对象会从一个区块撤离到另一个区块。区块被设计为并发地进行收集，而不停止其他的应用线程。</p>
<p>就像上图展示的，所有的区块都被分配为Eden、Suvivor和Old等角色。此外，还有第四种类型 – 大区块（Humongous regions）。这些大区块被设计为存放那些占用一半或者更大的区块大小的对象。他们被存放在若干个连续的区块中。最后一种类型的区块就是堆中还没使用的部分。</p>
<p><strong>注意：</strong> 在写这篇文章的时候，大对象的回收还没被优化。因此，你应该尽量避免创建大对象。</p>
<h4 id="3-G1的年轻代（Young-Generation-in-G1）"><a href="#3-G1的年轻代（Young-Generation-in-G1）" class="headerlink" title="3.G1的年轻代（Young Generation in G1）"></a>3.G1的年轻代（Young Generation in G1）</h4><p>堆空间被划分为大概2000个区块。区块的大小在1Mb~32Mb之间。蓝色的区块存放的是老年代对象，而绿色的区块存放着年轻代对象。<br><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog%2FG1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8%2FYoung%20Generation%20in%20G1.png" alt="Young Generation in G1.png"></p>
<p>值得注意的是，不像以前的垃圾收集器那样，G1里这些区块并不要求是连续的内存空间。</p>
<h4 id="4-G1的一次-Young-GC（A-Young-GC-in-G1）"><a href="#4-G1的一次-Young-GC（A-Young-GC-in-G1）" class="headerlink" title="4.G1的一次 Young GC（A Young GC in G1）"></a>4.G1的一次 Young GC（A Young GC in G1）</h4><p>存活对象会被疏散（复制或者移动）到一个或者多个suvivor区块。如果对象超过了老化阈值，则会被晋升到老年代区块中。</p>
<p><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog%2FG1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8%2FA%20Young%20GC%20in%20G1.png" alt="A Young GC in G1.png"></p>
<p>这个是一个stop the world (STW)的过程。这时候会为下一次Young GC计算Eden区和Suvivor区的大小。</p>
<p>这种方式可以非常容易地按照需要调整区块大小。</p>
<h4 id="5-G1的Young-GC结束之后（End-of-a-Young-GC-with-G1）"><a href="#5-G1的Young-GC结束之后（End-of-a-Young-GC-with-G1）" class="headerlink" title="5.G1的Young GC结束之后（End of a Young GC with G1）"></a>5.G1的Young GC结束之后（End of a Young GC with G1）</h4><p>存活对象都被疏散到Suvivor区块或者Old区块。</p>
<p><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog%2FG1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8%2FEnd%20of%20Young%20GC%20with%20G1.png" alt="End of Young GC with G1.png"></p>
<p>上图中，最新被晋升老年代的对象以深蓝色标注，而Suvivor区块以深绿色标注。</p>
<p>总结上述，G1的年轻代回收可以归纳为以下：</p>
<ul>
<li>堆空间就是一个被分割为多个区块的内存空间。</li>
<li>年轻代内存空间由一系列不连续的区块组成。这使得按需调整大小非常容易。</li>
<li>年轻代垃圾回收过程是一个stop the world过程。所有的应用线程都会被停止。</li>
<li>年轻代回收过程是一个多线程并发过程。</li>
<li>存活的对象会被复制到新的Suvivor区块以及Old区块。</li>
</ul>
<blockquote>
<p>G1的老年代收集过程</p>
</blockquote>
<p>跟CMS收集器类似，G1收集器被设计为用于老年代对象的低延迟收集器。以下表格介绍了G1在老年代上的收集过程。</p>
<h3 id="G1垃圾收集的阶段-并发标记周期阶段"><a href="#G1垃圾收集的阶段-并发标记周期阶段" class="headerlink" title="G1垃圾收集的阶段 - 并发标记周期阶段"></a>G1垃圾收集的阶段 - 并发标记周期阶段</h3><p>G1收集器在老年代上执行以下的几个步骤。值得注意的是，下面有些步骤其实是年轻代收集过程的一部分。</p>
<table>
<thead>
<tr>
<th>阶段</th>
<th>过程描述</th>
</tr>
</thead>
<tbody><tr>
<td>(1)初始标记<br>(Stop the World Event)</td>
<td>stop the world。这个过程发生在 young gc，用于标记那些引用了老年代对象的 Suvivor 区块(根区块 root regions)</td>
</tr>
<tr>
<td>(2)扫描根区块</td>
<td>扫描那些引用了老年代的 Suvivor 区块（根区块）。这个阶段是和应用线程并行执行。这个阶段必须在下一次 young gc 发生之前完成。</td>
</tr>
<tr>
<td>(3)并发标记</td>
<td>在全堆范围内寻找存活对象。这个阶段也是和应用线程并行执行。这个阶段可以被年轻代垃圾收集过程所打断</td>
</tr>
<tr>
<td>(4)重新标记<br>(Stop the World Event)</td>
<td>完成堆中存活对象的标记。这个阶段使用了一个叫 SATB(snapshot-at-the-beginning) 的算法，该算法比 CMS 收集器所用算法快非常多。</td>
</tr>
<tr>
<td>(5)并发清理<br>(Stop the World Event and Concurrent)</td>
<td>1)核算存活对象和完全空闲区块的记录数据（stop the world);   2)擦除 RSets(stop the world);  3)重置空区块，并且添加进空闲区块列表（并发）。</td>
</tr>
<tr>
<td>(*)复制<br>(Stop the World Event)</td>
<td>这是会发生多次的 STW 过程，过程中会疏散或者复制存活对象那到新的未使用区块上。复制过程可以发生在年轻代区块中，GC日志中显示为 [GC pause (young)]，或者同时发生在年轻代和老年代区块中，而GC日志中显示为 [GC Pause (mixed)]</td>
</tr>
</tbody></table>
<h3 id="逐步分析G1的老年代收集过程"><a href="#逐步分析G1的老年代收集过程" class="headerlink" title="逐步分析G1的老年代收集过程"></a>逐步分析G1的老年代收集过程</h3><p>经过以上的各阶段的简单介绍后，我们来看看他们在G1收集器的老年代回收过程中是如何相互影响的。</p>
<h4 id="6-初始标记阶段（Initial-Marking-Phase）"><a href="#6-初始标记阶段（Initial-Marking-Phase）" class="headerlink" title="6.初始标记阶段（Initial Marking Phase）"></a>6.初始标记阶段（Initial Marking Phase）</h4><p>针对存活对象的初始标记在年轻代垃圾收集阶段已经完成。在GC日志中显示为GC pause (young)(inital-mark)。</p>
<p><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog%2FG1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8%2FInitial%20Marking%20Phase.png" alt="Initial Marking Phase.png"></p>
<h4 id="7-并发标记阶段（Concurrent-Marking-Phase）"><a href="#7-并发标记阶段（Concurrent-Marking-Phase）" class="headerlink" title="7.并发标记阶段（Concurrent Marking Phase）"></a>7.并发标记阶段（Concurrent Marking Phase）</h4><p>如果发现空区块(下图用”X”标记),他们会在重新标记阶段直接移除。此外，决定存活情况的记录信息也会被计算。</p>
<p><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog%2FG1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8%2FConcurrent%20Marking%20Phase.png" alt="Concurrent Marking Phase.png"></p>
<h4 id="8-重新标记阶段（Remark-Phase）"><a href="#8-重新标记阶段（Remark-Phase）" class="headerlink" title="8.重新标记阶段（Remark Phase）"></a>8.重新标记阶段（Remark Phase）</h4><p>空区块会被删除并且回收。所有区块现在都会计算存活情况。<br><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog%2FG1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8%2FRemark%20Phase.png" alt="Remark Phase.png"></p>
<h4 id="9-复制清理阶段（Copying-Cleanup-Phase）"><a href="#9-复制清理阶段（Copying-Cleanup-Phase）" class="headerlink" title="9.复制清理阶段（Copying&#x2F;Cleanup Phase）"></a>9.复制清理阶段（Copying&#x2F;Cleanup Phase）</h4><p>G1会选择存活对象最少的区块来进行回收，因为这些区块回收速度会最快。这些区块会在一次young GC中被同时回收。GC日志中这个过程显示为[GC pause (mixed)]。因此，年轻代和老年代会在同一时间进行回收。</p>
<p><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog%2FG1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8%2FCopying%3ACleanup%20Phase.png" alt="Copying:Cleanup Phase.png"></p>
<h4 id="10-复制清理阶段之后（After-Copying-Cleanup-Phase）"><a href="#10-复制清理阶段之后（After-Copying-Cleanup-Phase）" class="headerlink" title="10.复制清理阶段之后（After Copying&#x2F;Cleanup Phase）"></a>10.复制清理阶段之后（After Copying&#x2F;Cleanup Phase）</h4><p>那些被选中的区块已经被收集并且压缩到了下图的深蓝色和深绿色的区块中。</p>
<p><img src="https://pic-bed-sz.oss-cn-shenzhen.aliyuncs.com/blog%2FG1%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E5%85%A5%E9%97%A8%2FAfter%20Copying%3ACleanup%20Phase.png" alt="After Copying:Cleanup Phase.png"></p>
<h3 id="老年代回收过程总结"><a href="#老年代回收过程总结" class="headerlink" title="老年代回收过程总结"></a>老年代回收过程总结</h3><p>我们可以对G1的老年代收集过程总结几个要点。</p>
<ul>
<li>并发标记阶段<ul>
<li>存活信息会在应用运行的时候并行计算；</li>
<li>这些存活信息指出了在疏散暂停时候哪些区块是最应该回收的；</li>
<li>没有类似CMS那样的清除阶段（sweeping phase）。</li>
</ul>
</li>
<li>重新标记阶段<ul>
<li>使用比CMS所用算法更快的SATB(Snapshot-at-the-Beginning)算法；</li>
<li>完全为空的区块会被回收；</li>
</ul>
</li>
<li>复制&#x2F;清理阶段<ul>
<li>年轻代和老年代会被同时回收；</li>
<li>基于对象存活情况，挑选老年代区块。</li>
</ul>
</li>
</ul>
<h2 id="命令行参数可选项以及最佳时间"><a href="#命令行参数可选项以及最佳时间" class="headerlink" title="命令行参数可选项以及最佳时间"></a>命令行参数可选项以及最佳时间</h2><p>这个章节里，我们会学习G1的各种命令行选项。</p>
<h3 id="命令行基本参数"><a href="#命令行基本参数" class="headerlink" title="命令行基本参数"></a>命令行基本参数</h3><p>为了使用G1收集器，需要指定参数：-XX:+UseG1GC</p>
<p>这是启动Java进程的一个样例：</p>
<pre><code class="bash">java -Xmx50m -Xms50m -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -jar c:\javademos\demo\jfc\Java2D\Java2demo.jar
</code></pre>
<h3 id="命令行关键参数"><a href="#命令行关键参数" class="headerlink" title="命令行关键参数"></a>命令行关键参数</h3><p><strong>-XX:+UseG1GC</strong> - 告诉JVM使用G1垃圾收集器；</p>
<p><strong>-XX:MaxGCPauseMillis&#x3D;200</strong> - 设置一个最大的GC停顿时间目标。这是一个软目标，JVM会尽最大能力去满足它。因此，停顿时间有时候并不会满足这个目标。默认值是200ms。</p>
<p><strong>-XX:InitiatingHeapOccupancyPercent&#x3D;45</strong> - 触发并发GC的堆内存占用阈值。G1收集器根据整个堆的占用情况而不是某个分代来触发一次并发回收循环。如果这个值指定为0，则意味着会进行恒定的GC循环。默认值为45（占用45%）。</p>
<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><h4 id="不要设置年轻代的大小"><a href="#不要设置年轻代的大小" class="headerlink" title="不要设置年轻代的大小"></a><strong>不要设置年轻代的大小</strong></h4><p>通过 <em>-Xmn</em> 显式设置年轻代大小，会干扰到G1的默认行为。</p>
<ul>
<li>G1不会再遵循回收停顿目标。因此实际上，设置年轻代大小会禁用停顿目标；</li>
<li>G1再也不能够按需要扩增或者收缩年轻代大小。因为大小已经被固定下来而不能做任何更改。</li>
</ul>
<h4 id="响应时间指标"><a href="#响应时间指标" class="headerlink" title="响应时间指标"></a><strong>响应时间指标</strong></h4><p>与其使用平均响应时间（ART)作为一个指标去设置XX:MaxGCPauseMillis&#x3D;N，不如考虑设置一个值，使得90%或更多时间满足这个停顿目标。这意味着90%的用户发起请求后得到应答的时间不会超过这个目标。请记住，这个停顿时间只是一个目标，而不能保证总是能满足它。</p>
<h4 id="什么是疏散失败-Evacuation-Failure"><a href="#什么是疏散失败-Evacuation-Failure" class="headerlink" title="什么是疏散失败?(Evacuation Failure)"></a><strong>什么是疏散失败?(Evacuation Failure)</strong></h4><p>当JVM对幸存对象进行回收或者在晋升对象到老年代的时候发生堆内存耗尽，将会触发一次晋升失败。此时堆空间不能再扩增，因为它已经处于最大值。当指定参数XX:+PrintGCDetails的时候，这种晋升失败的情况在日志里体现为：<strong>to-space overflow</strong>。而且这个过程会付出昂贵代价！</p>
<ul>
<li>GC必须继续下去，所以必须得释放出空间；</li>
<li>未能成功复制的对象必须安置到适当位置；</li>
<li>对CSet中的RSets的区块的任何更新都需要重建；（这句太难翻译了，原文是：Any updates to RSets of regions in the CSet have to be regenerated.）</li>
<li>所有这些步骤都是代价昂贵。</li>
</ul>
<h4 id="如何避免疏散失败"><a href="#如何避免疏散失败" class="headerlink" title="如何避免疏散失败"></a><strong>如何避免疏散失败</strong></h4><p>为了避免疏散失败，考虑以下选项。</p>
<ul>
<li><p>扩大堆空间</p>
<ul>
<li>增大-XX:G1ReservePercent&#x3D;n，默认值是10；</li>
<li>G1会设定一个虚拟上限，通过让这些保留内存空间闲置着，以防发生更多的”to-space”而需要这些内存。</li>
</ul>
</li>
<li><p>更早启动标记阶段</p>
</li>
<li><p>通过-XX:ConcGCThreads&#x3D;n参数，来增大标记线程数量</p>
</li>
</ul>
<h4 id="G1完整的GC开关"><a href="#G1完整的GC开关" class="headerlink" title="G1完整的GC开关"></a>G1完整的GC开关</h4><p>以下是G1 GC开关列表。请牢记上文提到的最佳实践。</p>
<table>
<thead>
<tr>
<th>GC选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>-XX:+UseG1GC</td>
<td>指定使用G1垃圾收集器</td>
</tr>
<tr>
<td>-XX:MaxGCPauseMillis&#x3D;n</td>
<td>设定一个最大的GC停顿时间目标。这是一个软目标，JVM会尽最大努力满足这个目标</td>
</tr>
<tr>
<td>-XX:InitiatingHeapOccupancyPercent&#x3D;n</td>
<td>触发并发GC的堆内存占用阈值。G1收集器根据整个堆的占用情况而不是某个分代来触发一次并发回收循环。如果这个值指定为0，则意味着会进行恒定的GC循环。默认值为45（占用45%）。</td>
</tr>
<tr>
<td>-XX:NewRatio&#x3D;n</td>
<td>新生代&#x2F;老年代的大小比率，默认值是2</td>
</tr>
<tr>
<td>-XX:SurvivorRatio&#x3D;n</td>
<td>Eden区&#x2F;Suvivor区的比率，默认值是8</td>
</tr>
<tr>
<td>-XX:MaxTenuringThreshold&#x3D;n</td>
<td>最大的存活次数。默认值是15</td>
</tr>
<tr>
<td>-XX:ParallelGCThreads&#x3D;n</td>
<td>设置并行阶段GC线程数量。不同平台上的默认值各不一样。</td>
</tr>
<tr>
<td>-XX:ConcGCThreads&#x3D;n</td>
<td>并发阶段的GC线程数量。不同平台上的默认值各不一样.</td>
</tr>
<tr>
<td>-XX:G1ReservePercent&#x3D;n</td>
<td>设置堆的保留空间阈值以降低发生晋升失败的可能。默认值是10</td>
</tr>
<tr>
<td>-XX:G1HeapRegionSize&#x3D;n</td>
<td>G1将堆空间划分为相同大小的区块。这个参数设置初始化时候的区块数量。该参数的默认值是根据堆空间来动态确定的。最小值为1Mb，最大值为32Mb</td>
</tr>
</tbody></table>
<h2 id="G1的GC日志"><a href="#G1的GC日志" class="headerlink" title="G1的GC日志"></a>G1的GC日志</h2><p>最后我们来看如何通过日志信息来分析G1收集器的表现。这个章节会介绍可以用来在日志中收集数据以及信息的参数。</p>
<h3 id="设置日志详情"><a href="#设置日志详情" class="headerlink" title="设置日志详情"></a>设置日志详情</h3><p>你可以设置三个不同级别的日志详情。</p>
<p>(1）**-verbosegc**（与 <strong>-XX:+PrintGC</strong> 相同）设置详情日志的级别为 <em>fine</em>。</p>
<p><strong>样例输出</strong></p>
<pre><code>[GC pause (G1 Humongous Allocation) (young) (initial-mark) 24M- &gt;21M(64M), 0.2349730 secs]
[GC pause (G1 Evacuation Pause) (mixed) 66M-&gt;21M(236M), 0.1625268 secs] 
</code></pre>
<p>(2) <strong>-XX:+PrintGCDetails</strong> 设置详情日志级别为 <em>finer</em>。这个选项展示以下信息：</p>
<ul>
<li>各个阶段的平均用时、最小用时和最大用时；</li>
<li>根扫描、RSet更新、RSet扫描、对象复制、终止(和尝试次数)；</li>
<li>另外也展示了其他时间，比如选择CSet时间、引用处理时间、引用入队时间和冻结CSet耗时；</li>
<li>展示Eden、Suvivor以及全堆的占用情况。</li>
</ul>
<p><strong>样例输出</strong></p>
<pre><code>[Ext Root Scanning (ms): Avg: 1.7 Min: 0.0 Max: 3.7 Diff: 3.7]
[Eden: 818M(818M)-&gt;0B(714M) Survivors: 0B-&gt;104M Heap: 836M(4096M)-&gt;409M(4096M)]
</code></pre>
<p>(3) <strong>-XX:+UnlockExperimentalVMOptions -XX:G1LogLevel&#x3D;finest</strong> 设置详情级别为 *finest**。跟finer级别类似，但包含了个别工作线程的信息。</p>
<pre><code>[Ext Root Scanning (ms): 2.1 2.4 2.0 0.0
           Avg: 1.6 Min: 0.0 Max: 2.4 Diff: 2.3]
       [Update RS (ms):  0.4  0.2  0.4  0.0
           Avg: 0.2 Min: 0.0 Max: 0.4 Diff: 0.4]
           [Processed Buffers : 5 1 10 0
           Sum: 16, Avg: 4, Min: 0, Max: 10, Diff: 10]
</code></pre>
<h3 id="指定时间参数"><a href="#指定时间参数" class="headerlink" title="指定时间参数"></a>指定时间参数</h3><p>有一些开关决定打印GC日志中的时间。</p>
<p>（1）**-XX:+PrintGCTimeStamps** - 当JVM启动后，打印运行时间。</p>
<p><strong>样例输出</strong></p>
<pre><code>1.729: [GC pause (young) 46M-&gt;35M(1332M), 0.0310029 secs]
</code></pre>
<p>（2）**-XX:+PrintGCDateStamps** - 每条记录都打印日期前缀。</p>
<p><strong>样例输出</strong></p>
<pre><code>2012-05-02T11:16:32.057+0200: [GC pause (young) 46M-&gt;35M(1332M), 0.0317225 secs]
</code></pre>
<h3 id="认识G1日志"><a href="#认识G1日志" class="headerlink" title="认识G1日志"></a>认识G1日志</h3><p>为了认识GC日志，这个章节使用实际的GC日志输出定义一些术语。以下的例子展示了日志的输出，并且附带了术语的解释。</p>
<p><em>注意:</em>* 了解更多信息请移步<a target="_blank" rel="noopener" href="https://blogs.oracle.com/poonam/entry/understanding_g1_gc_logs">Poonam Bajaj’s Blog post on G1 GC logs.</a></p>
<h3 id="G1日志术语"><a href="#G1日志术语" class="headerlink" title="G1日志术语"></a>G1日志术语</h3><ul>
<li><p>并行时间(Parallel Time)</p>
<pre><code>414.557: [GC pause (young), 0.03039600 secs] [Parallel Time: 22.9 ms]
[GC Worker Start (ms): 7096.0 7096.0 7096.1 7096.1 706.1 7096.1 7096.1 7096.1 7096.2 7096.2 7096.2 7096.2
    Avg: 7096.1, Min: 7096.0, Max: 7096.2, Diff: 0.2]
</code></pre>
<p>  Parallel Time - 暂停的主要并行部分的大体运行时间；<br>  Worker Start - workers开始的时间戳；<br>  <strong>注意:</strong> 这些日志都按照线程ID排序，并且每个条目都是一致的。</p>
</li>
<li><p>外部根扫描(External Root Scanning)</p>
<pre><code>[Ext Root Scanning (ms): 3.1 3.4 3.4 3.0 4.2 2.0 3.6 3.2 3.4 7.7 3.7 4.4
    Avg: 3.8, Min: 2.0, Max: 7.7, Diff: 5.7]
</code></pre>
<p>  External root scanning - 扫描外部根(例如指向堆空间的系统字典)所耗时间</p>
</li>
<li><p>更新RSet(Update Remembered Set)</p>
<pre><code>[Update RS (ms): 0.1 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 Avg: 0.0, Min: 0.0, Max: 0.1, Diff: 0.1]
[Processed Buffers : 26 0 0 0 0 0 0 0 0 0 0 0
    Sum: 26, Avg: 2, Min: 0, Max: 26, Diff: 26]
</code></pre>
<p>  Update Remembered Set - Any buffers that are completed but have not yet been processed by the concurrent refinement thread before the start of the pause have to be updated. Time depends on density of the cards. The more cards, the longer it will take.</p>
</li>
<li><p>扫描RSet(Scanning Remembered Sets)</p>
<pre><code>[Scan RS (ms): 0.4 0.2 0.1 0.3 0.0 0.0 0.1 0.2 0.0 0.1 0.0 0.0 Avg: 0.1, Min: 0.0, Max: 0.4, Diff: 0.3]F
</code></pre>
<p>  Scanning Remembered Sets - Look for pointers that point into the Collection Set.</p>
</li>
<li><p>对象复制(Object Copy)</p>
<pre><code>[Object Copy (ms): 16.7 16.7 16.7 16.9 16.0 18.1 16.5 16.8 16.7 12.3 16.4 15.7 Avg: 16.3, Min: 12.3, Max:  18.1, Diff: 5.8]
</code></pre>
<p>  Object copy – The time that each individual thread spent copying and evacuating objects.</p>
</li>
<li><p>Termination Time</p>
<pre><code>[Termination (ms): 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0
0.0 Avg: 0.0, Min: 0.0, Max: 0.0, Diff: 0.0] [Termination Attempts : 1 1 1 1 1 1 1 1 1 1 1 1 Sum: 12, Avg: 1, Min: 1, Max: 1, Diff: 0]
</code></pre>
<p>  Termination time - When a worker thread is finished with its particular set of objects to copy and scan, it enters the termination protocol. It looks for work to steal and once it’s done with that work it again enters the termination protocol. Termination attempt counts all the attempts to steal work.</p>
</li>
<li><p>GC Worker End</p>
<pre><code>[GC Worker End (ms): 7116.4 7116.3 7116.4 7116.3 7116.4 7116.3 7116.4 7116.4 7116.4 7116.4 7116.3 7116.3
    Avg: 7116.4, Min: 7116.3, Max: 7116.4, Diff:   0.1]
[GC Worker (ms): 20.4 20.3 20.3 20.2 20.3 20.2 20.2 20.2 20.3 20.2 20.1 20.1
    Avg: 20.2, Min: 20.1, Max: 20.4, Diff: 0.3]
</code></pre>
<p>  GC worker end time – Timestamp when the individual GC worker stops.</p>
<p>  GC worker time – Time taken by individual GC worker thread.</p>
</li>
<li><p>GC Worker Other</p>
<pre><code>[GC Worker Other (ms): 2.6 2.6 2.7 2.7 2.7 2.7 2.7 2.8 2.8 2.8 2.8 2.8
    Avg: 2.7, Min: 2.6, Max: 2.8, Diff: 0.2]
</code></pre>
<p>  GC worker other – The time (for each GC thread) that can’t be attributed to the worker phases listed previously. Should be quite low. In the past, we have seen excessively high values and they have been attributed to bottlenecks in other parts of the JVM (e.g., increases in the Code Cache occupancy with Tiered).</p>
</li>
<li><p>Clear CT</p>
<pre><code>[Clear CT: 0.6 ms]
</code></pre>
<p>  Time taken to clear the card table of RSet scanning meta-data</p>
</li>
<li><p>Other</p>
<pre><code>[Other: 6.8 ms]
</code></pre>
<p>  Time taken for various other sequential phases of the GC pause.</p>
</li>
<li><p>CSet</p>
<pre><code>[Choose CSet: 0.1 ms]
</code></pre>
<p>  Time taken finalizing the set of regions to collect. Usually very small; slightly longer when having to select old.</p>
</li>
<li><p>Ref Proc</p>
<pre><code>[Ref Proc: 4.4 ms]
</code></pre>
<p>  Time spent processing soft, weak, etc. references deferred from the prior phases of the GC.</p>
</li>
<li><p>Ref Enq</p>
<pre><code>[Ref Enq: 0.1 ms]
</code></pre>
<p>  Time spent placing soft, weak, etc. references on to the pending list.</p>
</li>
<li><p>Free CSet</p>
<pre><code>[Free CSet: 2.0 ms]
</code></pre>
<p>  Time spent freeing the set of regions that have just been collected, including their remembered sets.</p>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在本文中，你已经浏览学习了Java JVM里的G1垃圾收集器。首先你学习为何堆和垃圾收集器是Java JVM的重要组成部分。然后回顾了CMS和G1垃圾收集器是如何工作的。接着学习了G1的命令行开关以及使用它们的最佳实践。最后学习了GC日志中的打印对象以及数据。</p>
<p>在这个教程中，你学习了：</p>
<ul>
<li>Java JVM的组成部分；</li>
<li>G1收集器的概述；</li>
<li>回顾CMS收集器；</li>
<li>回顾G1收集器；</li>
<li>命令行开关和最佳实践；</li>
<li>G1的日志。</li>
</ul>
<h3 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h3><p>更多相关信息请查看以下网页链接：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html">Java HotSpot VM Options</a></li>
<li><a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/javase/tech/g1-intro-jsp-135488.html">The Garbage First(G1) Garbage Collector</a></li>
<li><a target="_blank" rel="noopener" href="https://blogs.oracle.com/poonam/entry/understanding_g1_gc_logs">Poonam Bajaj G1 GC Blog Post</a></li>
<li><a target="_blank" rel="noopener" href="http://education.oracle.com/pls/web_prod-plq-dad/db_pages.getpage?page_id=609&p_org_id=1001&lang=US&get_params=dc:D67232GC10,p_preview:N">Java SE 7: Develop Rich Client Applications</a></li>
<li><a target="_blank" rel="noopener" href="http://www.amazon.com/Java-Performance-Charlie-Hunt/dp/0137142528/ref=sr_1_1">Java Performance - Charlie Hunt and Binu John</a></li>
<li><a target="_blank" rel="noopener" href="http://www.oracle.com/oll">Oracle Learning Library</a></li>
</ul>
<h3 id="鸣谢"><a href="#鸣谢" class="headerlink" title="鸣谢"></a>鸣谢</h3><ul>
<li>Curriculum Developer: Michael J Williams</li>
<li>QA: Krishnanjani Chitta</li>
</ul>

      
       <hr><span style="font-style: italic;color: gray;"> 转载请注明来源，欢迎对文章中的引用来源进行考证，欢迎指出任何有错误或不够清晰的表达。可以在下面评论区评论，也可以邮件至 duval1024@gmail.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">赏</a>
</p>




    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: '0249fec24dcaf3532c31',
            clientSecret: '8ca1dd59f6b90d119d2206a05550f959dcc8e211',
            repo: 'baygeekarea_commet_area',
            owner: 'duval1024',
            admin: ['duval1024'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2016-2024 Duval
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">×</a>
    <div class="shang_tit">
        <p>喜欢就点赞,疼爱就打赏</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.png" class="alipay" title="扫码支持">
            <img src="/img/wechat.png" class="weixin" title="扫码支持">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">支付宝</label></span><span><label><input type="radio" name="pay" value="weixin">微信</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().trim().split('\n').length, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 18px 3px 15px 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: #fafafa;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #050505;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #050505;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #fbf4aB;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>







</html>
